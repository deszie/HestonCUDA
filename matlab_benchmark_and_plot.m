%% data
strikes = linspace(.8,1.2,11);% strike range
mats = linspace(.3,3,11); %maturity range
n = 8;
fft_times = [];
quad_times = [];
n_vals = [];
while (n <= 131072)
    n_vals = [n_vals n];
    n = n*2;
    tic
    for j=1:256
        HestonCallFft(2,.04,.1,0.5,.04,.01,mats(3),1,strikes(5),n);
    end
    fft_times = [fft_times; toc]
    
    tic
    for j=1:256
        price_quad = HestonCallQuad_(2,.04,.1,0.5,.04,.01,mats(3),1,strikes(5),n);
    end
    quad_times = [quad_times; toc]
end

%% plot
close all
figure('Units', 'pixels', ...
    'Position', [100 100 500 375]);
hold on
plot(log2(n_vals), heston(:,2), 'LineWidth', 1.5, 'color','b', ...
    'LineSmoothing','on', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals), heston(:,3), 'LineWidth', 1.5, 'color','r', ...
    'LineSmoothing','on', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
% plot(log2(n_vals), quad_times, 'LineWidth', 1.5, 'color',[0 .5 0], ...
%     'LineSmoothing','on', ...
%     'LineSmoothing','on', ...
%     'Marker', '*', 'MarkerSize', 3);

leg = legend('CPU','GPU','MATLAB');
set(leg, 'Location', 'NorthWest')
titl = title('Quad Runtime');
xl = xlabel('Log_2(N)');
yl = ylabel('Runtime (sec)');
%axis([3 17 0 1050])
set( gca                       , ...
    'FontName'   , 'Helvetica' );
set([titl, xl, yl, leg], ...
    'FontName'   , 'AvantGarde');
set([leg, gca]             , ...
    'FontSize'   , 8           );
set([xl, yl, leg]  , ...
    'FontSize'   , 10          );
set( titl                    , ...
    'FontSize'   , 12          , ...
    'FontWeight' , 'bold'      );
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'on'      , ...
  'YMinorTick'  , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'YTick'       , 0:5:2500, ...
  'LineWidth'   , 1         );

set(gcf, 'PaperPositionMode', 'auto');
print -dpng quad.png



%% speedup plot
close all
figure('Units', 'pixels', ...
    'Position', [100 100 500 375]);
hold on
l1 = plot(log2(n_vals),quad_times./heston(:,2),'LineWidth', 1.5, ...
    'color','b','LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
l2 = plot(log2(n_vals),quad_times./heston(:,3),'LineWidth', 1.5, ...
    'color','r', 'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
leg = legend('CPU','GPU');
set(leg, 'Location', 'NorthWest')
titl = title('Quad Speedup vs. MATLAB');
xl = xlabel('Log_2(N)');
yl = ylabel('Times speedup');

set( gca                       , ...
    'FontName'   , 'Helvetica' );
set([titl, xl, yl, leg], ...
    'FontName'   , 'AvantGarde');
set([leg, gca]             , ...
    'FontSize'   , 8           );
set([xl, yl, leg]  , ...
    'FontSize'   , 10          );
set( titl                    , ...
    'FontSize'   , 12          , ...
    'FontWeight' , 'bold'      );
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'on'      , ...
  'YMinorTick'  , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'YTick'       , 0:100:2500, ...
  'LineWidth'   , 1         );

set(gcf, 'PaperPositionMode', 'auto');
print -dpng quad_speedup.png
%% fft1
close all
figure('Units', 'pixels', ...
    'Position', [100 100 500 375]);
hold on
plot(log2(n_vals), heston(:,4), 'LineWidth', 1.5, 'color','b', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals), heston(:,5), 'LineWidth', 1.5, 'color','r', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
% plot(log2(n_vals), fft_times, 'LineWidth', 1.5, 'color',[0 .5 0], ...
%     'LineSmoothing','on', ...
%     'Marker', '*', 'MarkerSize', 3);

leg = legend('CPU','GPU','MATLAB');
set(leg, 'Location', 'NorthWest')
titl = title('FFT Runtime');
xl = xlabel('Log_2(N)');
yl = ylabel('Runtime (sec)');

set( gca                       , ...
    'FontName'   , 'Helvetica' );
set([titl, xl, yl, leg], ...
    'FontName'   , 'AvantGarde');
set([leg, gca]             , ...
    'FontSize'   , 8           );
set([xl, yl, leg]  , ...
    'FontSize'   , 10          );
set( titl                    , ...
    'FontSize'   , 12          , ...
    'FontWeight' , 'bold'      );
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'on'      , ...
  'YMinorTick'  , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'YTick'       , 0:5:2500, ...
  'LineWidth'   , 1         );

set(gcf, 'PaperPositionMode', 'auto');
print -dpng fft.png


%% fft2

close all
figure('Units', 'pixels', ...
    'Position', [100 100 500 375]);
hold on
plot(log2(n_vals),fft_times./heston(:,4),'LineWidth', 1.5, 'color','b', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals),fft_times./heston(:,5),'LineWidth', 1.5, 'color','r', ...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);

leg = legend('CPU','GPU');
set(leg, 'Location', 'NorthWest')
titl = title('FFT Speedup vs. MATLAB');
xl = xlabel('Log_2(N)');
yl = ylabel('Times Speedup');

set( gca                       , ...
    'FontName'   , 'Helvetica' );
set([titl, xl, yl, leg], ...
    'FontName'   , 'AvantGarde');
set([leg, gca]             , ...
    'FontSize'   , 8           );
set([xl, yl, leg]  , ...
    'FontSize'   , 10          );
set( titl                    , ...
    'FontSize'   , 12          , ...
    'FontWeight' , 'bold'      );
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'on'      , ...
  'YMinorTick'  , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'YTick'       , 0:10:2500, ...
  'LineWidth'   , 1         );

set(gcf, 'PaperPositionMode', 'auto');
print -dpng fft_speedup.png

%% fft vs quad
close all
figure('Units', 'pixels', ...
    'Position', [100 100 500 375]);
hold on
plot(log2(n_vals),heston(:,2),'LineWidth', 1.5, 'color','b',...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals),heston(:,3),'LineWidth', 1.5, 'color',[.2,.2,1],...
    'LineSmoothing','on', 'LineStyle', '--', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals),heston(:,4),'LineWidth', 1.5, 'color','r',...
    'LineSmoothing','on', ...
    'Marker', '*', 'MarkerSize', 3);
plot(log2(n_vals),heston(:,5),'LineWidth', 1.5, 'color',[1,.2,.2],...
    'LineSmoothing','on', 'LineStyle', '--', ...
    'Marker', '*', 'MarkerSize', 3);

leg = legend('Quad CPU','Quad GPU','FFT CPU', 'FFT GPU');
set(leg, 'Location', 'NorthWest')
titl = title('Quad and FFT Runtime');
xl = xlabel('Log_2(N)');
yl = ylabel('Runtime (sec)');
axis([6 15 0 2])
set( gca                       , ...
    'FontName'   , 'Helvetica' );
set([titl, xl, yl, leg], ...
    'FontName'   , 'AvantGarde');
set([leg, gca]             , ...
    'FontSize'   , 8           );
set([xl, yl, leg]  , ...
    'FontSize'   , 10          );
set( titl                    , ...
    'FontSize'   , 12          , ...
    'FontWeight' , 'bold'      );
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'off'      , ...
  'YMinorTick'  , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'YTick'       , 0:.5:20, ...
  'LineWidth'   , 1         );

set(gcf, 'PaperPositionMode', 'auto');
print -dpng quad_vs_fft.png
